name: Se connecter à Google Cloud Shell

on:
  push:
    branches:
      - main

jobs:
  connect-to-google-cloud-shell:
    runs-on: ubuntu-latest

    steps:
    - name: Récupérer le code
      uses: actions/checkout@v2

    - name: Configurer l'outil de ligne de commande Google Cloud
      env:
        GOOGLE_APPLICATION_CREDENTIALS: ${{ secrets.GCP_SA_KEY }}
      run: |
        # Installer l'outil de ligne de commande gcloud
        curl -sSL https://sdk.cloud.google.com | bash
        exec -l $SHELL
        gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS
        gcloud config set project elevated-apex-403206
        gcloud config set account env-test@elevated-apex-403206.iam.gserviceaccount.com
        gcloud compute instances list
